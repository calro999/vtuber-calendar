<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çš†ã§ä½œã‚‹Vå›³é‘‘ï¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --v-pink: #ff85a2; --v-blue: #3ab0ff; --v-orange: #ff9f1c; --v-purple: #9d4edd; }
        body { font-family: 'M PLUS Rounded 1c', sans-serif; background-color: #fdf2f4; color: #333; }
        
        /* ã‚¿ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼šã‚ˆã‚Šæ´—ç·´ã•ã‚ŒãŸå½¢ã¸ */
        .nav-bar { background: white; border-radius: 50px; box-shadow: 0 4px 15px rgba(255,133,162,0.1); padding: 5px; display: flex; gap: 5px; }
        .nav-btn { flex: 1; padding: 10px 5px; border-radius: 40px; font-size: 0.85rem; font-weight: bold; color: #aaa; transition: 0.3s; text-align: center; cursor: pointer; }
        .nav-btn.active { background: var(--v-pink); color: white; }

        /* é…ä¿¡ãƒªã‚¹ãƒˆï¼šä¸€ç›®ã§ã‚ã‹ã‚‹è‰²åˆ†ã‘ */
        .list-card { background: white; border-radius: 18px; margin-bottom: 12px; overflow: hidden; border-left: 8px solid; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .cat-é›‘è«‡ { border-color: var(--v-blue); }
        .cat-ã‚²ãƒ¼ãƒ  { border-color: var(--v-orange); }
        .cat-æ­Œæ  { border-color: var(--v-pink); }
        .cat-ãã®ä»– { border-color: var(--v-purple); }

        /* ã‚¹ãƒ¯ã‚¤ãƒ—UIï¼šTinderé¢¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾©æ´» */
        #ohvContainer { perspective: 1000px; height: 500px; width: 100%; max-width: 360px; position: relative; }
        .v-card { position: absolute; width: 100%; height: 100%; background: white; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); transition: transform 0.4s ease, opacity 0.4s; overflow: hidden; cursor: grab; }
        .v-card:active { cursor: grabbing; }

        /* å¿œæ´ãƒœã‚¿ãƒ³UIï¼šå¸¸æ™‚è¡¨ç¤ºã§ã¯ãªãã€ãŠã¯Vãƒšãƒ¼ã‚¸ã®ã¿ */
        .cheer-tray { display: flex; gap: 8px; overflow-x: auto; padding: 15px; background: rgba(255,255,255,0.9); backdrop-filter: blur(5px); border-radius: 20px; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); margin-top: 20px; }
        .tag-chip { background: white; border: 2px solid var(--v-pink); color: var(--v-pink); padding: 8px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; white-space: nowrap; }

        /* å…¨Vå›³é‘‘ï¼šã‚°ãƒªãƒƒãƒ‰ */
        .zukan-item { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        
        .hidden { display: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-10">
    <div class="max-w-md mx-auto px-4 pt-6">
        <header class="mb-6">
            <h1 class="text-2xl font-black text-center text-[#ff85a2] mb-6">çš†ã§ä½œã‚‹Vå›³é‘‘ï¼</h1>
            <nav class="nav-bar">
                <div id="tabMain" class="nav-btn active" onclick="switchTab('main')">é…ä¿¡ä¸€è¦§</div>
                <div id="tabTimeline" class="nav-btn" onclick="switchTab('timeline')">æ™‚é–“å‰²</div>
                <div id="tabOhv" class="nav-btn" onclick="switchTab('ohv')">ä»Šæ—¥ã®ãŠã¯V</div>
                <div id="tabZukan" class="nav-btn" onclick="switchTab('zukan')">å›³é‘‘</div>
            </nav>
        </header>

        <div id="viewMain">
            <div id="streamList"></div>
        </div>

        <div id="viewTimeline" class="hidden">
            <div id="timelineContainer" class="bg-white rounded-3xl p-4 shadow-inner"></div>
        </div>

        <div id="viewOhv" class="hidden flex flex-col items-center">
            <div id="ohvContainer"></div>
            <p class="text-[10px] text-gray-400 mt-4">â† èˆˆå‘³ãªã— | å¿œæ´ï¼ˆè©•ä¾¡ï¼‰ã¯ãƒœã‚¿ãƒ³ã‹ã‚‰ â†’</p>
            <div class="cheer-tray no-scrollbar" id="cheerTray">
                <button class="tag-chip" onclick="cheerV('ã‚«ãƒ¯ãƒœ')">ã‚«ãƒ¯ãƒœ ğŸ€</button>
                <button class="tag-chip" onclick="cheerV('ã‚¤ã‚±ãƒœ')">ã‚¤ã‚±ãƒœ âœ¨</button>
                <button class="tag-chip" onclick="cheerV('ãƒ­ãƒªãƒœ')">ãƒ­ãƒªãƒœ ğŸ¼</button>
                <button class="tag-chip" onclick="cheerV('ãŠå§‰ã•ã‚“')">ãŠå§‰ã•ã‚“ ğŸ‘ </button>
                <button class="tag-chip" onclick="cheerV('è³‘ã‚„ã‹')">è³‘ã‚„ã‹ âš¡ï¸</button>
                <button class="tag-chip" onclick="cheerV('ç™’ã‚„ã—')">ç™’ã‚„ã— ğŸŒ™</button>
            </div>
        </div>

        <div id="viewZukan" class="hidden">
            <div id="zukanList" class="grid grid-cols-2 gap-3"></div>
        </div>

        <div class="mt-10 p-4 bg-white rounded-2xl border-2 border-pink-100">
            <p class="text-xs font-bold text-pink-400 mb-2">ï¼‹ æƒ…å ±ã‚’è¿½åŠ ã™ã‚‹</p>
            <div class="flex gap-2">
                <button onclick="showForm('stream')" class="bg-blue-400 text-white text-[10px] px-3 py-2 rounded-lg font-bold">é…ä¿¡äºˆå®š</button>
                <button onclick="showForm('ohv')" class="bg-orange-400 text-white text-[10px] px-3 py-2 rounded-lg font-bold">ãŠã¯V</button>
            </div>
            <div id="formContainer" class="mt-4 hidden border-t pt-4">
                <form id="vForm" class="grid gap-2">
                    <input type="text" id="inputName" placeholder="åå‰" class="text-xs p-2 border rounded-lg">
                    <input type="url" id="inputUrl" placeholder="Xã®ãƒã‚¹ãƒˆURL" class="text-xs p-2 border rounded-lg">
                    <div id="streamExtra" class="hidden grid grid-cols-2 gap-2">
                        <input type="date" id="inputDate" class="text-xs p-2 border rounded-lg">
                        <input type="time" id="inputTime" class="text-xs p-2 border rounded-lg">
                        <select id="inputGenre" class="text-xs p-2 border rounded-lg col-span-2">
                            <option value="é›‘è«‡">é›‘è«‡</option><option value="ã‚²ãƒ¼ãƒ ">ã‚²ãƒ¼ãƒ </option><option value="æ­Œæ ">æ­Œæ </option><option value="ãã®ä»–">ãã®ä»–</option>
                        </select>
                    </div>
                    <button type="submit" class="bg-pink-400 text-white py-2 rounded-lg font-bold text-xs">ç™»éŒ²å®Œäº†</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbw5zrtCgsZDoX3dZ6Dvup_X3Ej2-GNO5Gr8UzLUsTEi8idPnW--1bU4bZ4KcSAMiZcH/exec";
        let allData = [];
        let ohvQueue = [];
        let currentType = 'stream';

        async function fetchData() {
            const res = await fetch(`${GAS_URL}?t=${Date.now()}`);
            allData = await res.json();
            renderAll();
        }

        function renderAll() {
            renderMain();
            renderTimeline();
            renderOhv();
            renderZukan();
        }

        function renderMain() {
            const list = document.getElementById('streamList');
            const today = new Date().toLocaleDateString('ja-JP', {timeZone: 'Asia/Tokyo'}).replace(/\//g, '-');
            const items = allData.filter(d => d.type === 'é…ä¿¡' && d.date.replace(/\//g, '-') === today);
            
            list.innerHTML = items.length ? "" : "<p class='text-center py-10 text-gray-400 text-xs'>æœ¬æ—¥ã®é…ä¿¡äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“</p>";
            items.sort((a,b) => a.time.localeCompare(b.time)).forEach(d => {
                const tid = d.url.split('/status/')[1]?.split('?')[0];
                list.innerHTML += `
                    <div class="list-card cat-${d.genre}">
                        <div class="p-3 flex justify-between items-center">
                            <div>
                                <span class="text-xs font-black text-gray-400">${d.time}</span>
                                <span class="ml-2 font-bold text-sm">${d.name}</span>
                            </div>
                            <span class="text-[10px] px-2 py-1 rounded-full bg-gray-100 font-bold">${d.genre}</span>
                        </div>
                        <div class="px-3 pb-3">
                            <button onclick="window.open('${d.url}')" class="w-full bg-gray-50 text-[10px] py-2 rounded-lg text-gray-500 font-bold">å‘ŠçŸ¥ãƒã‚¹ãƒˆã‚’è¦‹ã‚‹</button>
                        </div>
                    </div>`;
            });
        }

        function renderTimeline() {
            const container = document.getElementById('timelineContainer');
            container.innerHTML = "";
            const today = new Date().toLocaleDateString('ja-JP', {timeZone: 'Asia/Tokyo'}).replace(/\//g, '-');
            const items = allData.filter(d => d.type === 'é…ä¿¡' && d.date.replace(/\//g, '-') === today);

            for(let h=0; h<24; h++) {
                const hourItems = items.filter(d => parseInt(d.time.split(':')[0]) === h);
                container.innerHTML += `
                    <div class="flex items-start mb-4">
                        <div class="w-12 text-center text-[10px] font-bold text-pink-300 mt-1">${h}:00</div>
                        <div class="flex-1 flex flex-wrap gap-2">
                            ${hourItems.length ? hourItems.map(i => `<div onclick="window.open('${i.url}')" class="bg-white border-2 border-pink-100 text-[10px] px-3 py-1 rounded-full font-bold">${i.name}</div>`).join('') : '<div class="h-4 w-full border-b border-dashed border-pink-50"></div>'}
                        </div>
                    </div>`;
            }
        }

        function renderOhv() {
            const container = document.getElementById('ohvContainer');
            ohvQueue = allData.filter(d => d.type === 'ãŠã¯V' && !d.voice).reverse();
            container.innerHTML = ohvQueue.length ? "" : "<p class='text-center mt-20 text-gray-400'>è©•ä¾¡å¾…ã¡ã®ãƒã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>";
            
            ohvQueue.forEach((d, i) => {
                const tid = d.url.split('/status/')[1]?.split('?')[0];
                const card = document.createElement('div');
                card.className = "v-card p-4";
                card.style.zIndex = 100 - i;
                card.innerHTML = `
                    <div class="text-center font-bold text-pink-400 mb-2">${d.name}</div>
                    <div class="h-[80%] overflow-hidden rounded-xl border">
                        <iframe src="https://platform.twitter.com/embed/Tweet.html?id=${tid}" width="100%" height="100%" frameborder="0"></iframe>
                    </div>`;
                
                // ç°¡æ˜“ã‚¹ãƒ¯ã‚¤ãƒ—ï¼ˆå·¦ã«é£›ã°ã™æ©Ÿèƒ½ï¼‰
                card.onclick = (e) => {
                    if(e.offsetX < 100) { card.style.transform = "translateX(-150%) rotate(-20deg)"; setTimeout(()=>card.remove(), 400); }
                };
                container.appendChild(card);
            });
        }

        async function cheerV(tag) {
            const target = ohvQueue[0];
            if(!target) return;
            const card = document.querySelector('.v-card:last-child');
            card.style.transform = "translateX(150%) rotate(20deg)";
            setTimeout(()=>card.remove(), 400);
            ohvQueue.shift();

            await fetch(GAS_URL, { method: "POST", mode: "no-cors", body: JSON.stringify({ action: "rate", url: target.url, voice: tag, atm: "å¿œæ´" }) });
        }

        function renderZukan() {
            const list = document.getElementById('zukanList');
            const rated = allData.filter(d => d.type === 'ãŠã¯V' && d.voice);
            list.innerHTML = rated.map(d => `
                <div class="zukan-item p-2" onclick="window.open('${d.url}')">
                    <div class="text-[10px] font-bold text-gray-400 truncate">${d.name}</div>
                    <div class="bg-pink-50 text-[9px] text-pink-500 px-2 py-1 rounded-full inline-block mt-1">#${d.voice}</div>
                    <div class="bg-blue-50 text-[9px] text-blue-500 px-2 py-1 rounded-full inline-block mt-1">#${d.atm}</div>
                </div>
            `).join('');
        }

        function switchTab(t) {
            ['viewMain', 'viewTimeline', 'viewOhv', 'viewZukan'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById('view' + t.charAt(0).toUpperCase() + t.slice(1)).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab' + t.charAt(0).toUpperCase() + t.slice(1)).classList.add('active');
        }

        function showForm(type) {
            currentType = type;
            document.getElementById('formContainer').classList.remove('hidden');
            document.getElementById('streamExtra').classList.toggle('hidden', type !== 'stream');
        }

        document.getElementById('vForm').onsubmit = async (e) => {
            e.preventDefault();
            const data = {
                type: currentType === 'stream' ? 'é…ä¿¡' : 'ãŠã¯V',
                name: document.getElementById('inputName').value,
                url: document.getElementById('inputUrl').value,
                date: document.getElementById('inputDate').value || "",
                time: document.getElementById('inputTime').value || "",
                genre: document.getElementById('inputGenre').value || ""
            };
            await fetch(GAS_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(data) });
            alert("ç™»éŒ²ã—ã¾ã—ãŸï¼");
            fetchData();
        }

        window.onload = fetchData;
    </script>
</body>
</html>
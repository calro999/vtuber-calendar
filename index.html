<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VTuberç·åˆç•ªçµ„è¡¨ï¼†çš†ã§ä½œã‚‹Vå›³é‘‘ğŸ€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'M PLUS Rounded 1c', sans-serif; background-color: #fff5f7; overflow-x: hidden; }
        .pink-gradient { background: linear-gradient(135deg, #ffdeeb 0%, #ffb7c5 100%); }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 2px solid #ffb7c5; }
        .nav-btn { padding: 8px 16px; border-radius: 999px; font-weight: bold; transition: 0.3s; background: white; color: #ffb7c5; border: 2px solid #ffb7c5; font-size: 0.8rem; }
        .nav-btn.active { background: #ffb7c5; color: white; }
        
        /* Tinderé¢¨ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ãƒƒã‚¯ */
        #ohvStack { position: relative; height: 500px; width: 100%; max-width: 400px; margin: 0 auto; }
        .swipe-card { position: absolute; width: 100%; height: 100%; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #ffdeeb; transition: transform 0.5s, opacity 0.5s; display: flex; flex-direction: column; overflow: hidden; }
        .iframe-container { flex: 1; overflow: hidden; position: relative; pointer-events: none; } /* ã‚«ãƒ¼ãƒ‰è‡ªä½“ã¯è§¦ã‚‰ã›ãªã„ */
        .iframe-container iframe { width: 100%; height: 600px; transform: scale(0.85); transform-origin: top center; border: none; }
        .card-cover { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; cursor: pointer; } /* Xã¸é£›ã°ã™ç”¨ */

        /* 2æ®µéšå±æ€§ãƒˆãƒ¬ã‚¤ */
        #tagTray { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 3px solid #ffb7c5; padding: 15px; z-index: 100; transform: translateY(100%); transition: 0.3s; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); }
        #tagTray.open { transform: translateY(0); }
        .tag-grid { display: grid; grid-cols: 3; gap: 8px; }
        .tag-btn { padding: 12px 5px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; text-align: center; border: 1px solid #eee; transition: 0.2s; }
        .tag-btn:active { transform: scale(0.95); }

        /* Vå›³é‘‘ã‚¹ã‚¿ã‚¤ãƒ« */
        .zukan-card { background: white; border-radius: 15px; border: 1px solid #ffdeeb; overflow: hidden; font-size: 0.75rem; }
        .score-tag { padding: 2px 8px; border-radius: 999px; background: #fff0f3; color: #ff85a2; font-weight: bold; }

        .hidden { display: none; }
        .swiped-left { transform: translateX(-150%) rotate(-20deg); opacity: 0; }
        .swiped-right { transform: translateX(150%) rotate(20deg); opacity: 0; }

        /* æµã‚Œã‚‹ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ */
        .marquee { overflow: hidden; background: #ff85a2; color: white; padding: 4px 0; font-size: 0.8rem; font-weight: bold; }
        .marquee p { display: inline-block; white-space: nowrap; animation: marquee 20s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
    </style>
</head>
<body>

    <div class="marquee"><p id="announcement">ğŸ“¢ æœ¬æ—¥ã®é‘‘å®šå£«å‹Ÿé›†ä¸­ï¼ã‚ãªãŸã®è€³ã§VTuberå›³é‘‘ã‚’å®Œæˆã•ã›ã‚ˆã†ï¼âœ¨</p></div>

    <div class="max-w-4xl mx-auto p-4">
        <header class="text-center my-6">
            <h1 class="text-2xl font-bold text-[#ff85a2]">ğŸ€ VTuberç·åˆç•ªçµ„è¡¨ï¼†Vå›³é‘‘ ğŸ€</h1>
            <div class="flex justify-center gap-2 mt-4">
                <button id="tabMain" class="nav-btn active" onclick="switchTab('main')">é…ä¿¡ä¸€è¦§</button>
                <button id="tabOhv" class="nav-btn" onclick="switchTab('ohv')">çˆ†é€Ÿé‘‘å®š(ãŠã¯V)</button>
                <button id="tabZukan" class="nav-btn" onclick="switchTab('zukan')">çš†ã§ä½œã‚‹Vå›³é‘‘</button>
            </div>
        </header>

        <main id="viewMain" class="space-y-6">
            <div id="streamList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </main>

        <section id="viewOhv" class="hidden flex flex-col items-center">
            <p class="text-[10px] text-gray-500 mb-4">ç”»åƒã‚’ã‚¿ãƒƒãƒ—ã§Xã¸é£›ã‚“ã§å£°ã‚’ãƒã‚§ãƒƒã‚¯ï¼ä¸‹ã®ãƒœã‚¿ãƒ³ã§é‘‘å®šï¼</p>
            <div id="ohvStack"></div>
        </section>

        <section id="viewZukan" class="hidden">
            <div class="mb-4 flex gap-2 overflow-x-auto pb-2" id="zukanFilters">
                <button class="nav-btn active">ã™ã¹ã¦</button>
                <button class="nav-btn">ã‚«ãƒ¯ãƒœ</button>
                <button class="nav-btn">ãƒã‚¹ã‚­ãƒ¼</button>
                <button class="nav-btn">ç™’ã‚„ã—</button>
            </div>
            <div id="zukanList" class="grid grid-cols-2 md:grid-cols-3 gap-3"></div>
        </section>
    </div>

    <div id="tagTray">
        <div id="step1" class="space-y-3">
            <p class="text-center font-bold text-[#ff85a2] text-sm">ã€Step 1ã€‘å£°è³ªã‚’é¸ã‚“ã§ãã ã•ã„</p>
            <div class="grid grid-cols-3 gap-2">
                <button class="tag-btn bg-pink-50" onclick="chooseStep1('ã‚«ãƒ¯ãƒœ')">ã‚«ãƒ¯ãƒœ</button>
                <button class="tag-btn bg-blue-50" onclick="chooseStep1('ã‚¤ã‚±ãƒœ')">ã‚¤ã‚±ãƒœ</button>
                <button class="tag-btn bg-orange-50" onclick="chooseStep1('ãƒ­ãƒªãƒœ')">ãƒ­ãƒªãƒœ</button>
                <button class="tag-btn bg-purple-50" onclick="chooseStep1('ãŠå§‰ã•ã‚“')">ãŠå§‰ã•ã‚“</button>
                <button class="tag-btn bg-gray-50" onclick="chooseStep1('ãƒã‚¹ã‚­ãƒ¼')">ãƒã‚¹ã‚­ãƒ¼</button>
                <button class="tag-btn bg-green-50" onclick="chooseStep1('ä¸­æ€§çš„')">ä¸­æ€§çš„</button>
            </div>
        </div>
        <div id="step2" class="hidden space-y-3">
            <p class="text-center font-bold text-[#ff85a2] text-sm">ã€Step 2ã€‘é…ä¿¡ã®é›°å›²æ°—ã¯ï¼Ÿ</p>
            <div class="grid grid-cols-3 gap-2">
                <button class="tag-btn bg-yellow-50" onclick="completeAuth('ã‚¢ãƒƒãƒˆãƒ›ãƒ¼ãƒ ')">ã‚¢ãƒƒãƒˆãƒ›ãƒ¼ãƒ </button>
                <button class="tag-btn bg-red-50" onclick="completeAuth('å¿œæ´å‹')">å¿œæ´å‹</button>
                <button class="tag-btn bg-indigo-50" onclick="completeAuth('è½ã¡ç€ã„ãŸ')">è½ã¡ç€ã„ãŸ</button>
                <button class="tag-btn bg-yellow-100" onclick="completeAuth('è³‘ã‚„ã‹')">è³‘ã‚„ã‹</button>
                <button class="tag-btn bg-pink-100" onclick="completeAuth('ã‚®ãƒ£ãƒƒãƒ—ã‚ã‚Š')">ã‚®ãƒ£ãƒƒãƒ—ã‚ã‚Š</button>
                <button class="tag-btn bg-gray-200" onclick="cancelAuth()">ã‚ã‹ã‚‰ãªã„</button>
            </div>
        </div>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbw5zrtCgsZDoX3dZ6Dvup_X3Ej2-GNO5Gr8UzLUsTEi8idPnW--1bU4bZ4KcSAMiZcH/exec";
        let allData = [];
        let currentCardIndex = 0;
        let selectedVoice = "";

        async function fetchData() {
            const res = await fetch(GAS_URL);
            allData = await res.json();
            renderAll();
        }

        function renderAll() {
            renderStreams();
            renderStack();
            renderZukan();
        }

        // é…ä¿¡ä¸€è¦§
        function renderStreams() {
            const list = document.getElementById('streamList');
            list.innerHTML = "";
            allData.filter(d => d.type === "é…ä¿¡").forEach(item => {
                const tweetId = item.url.split('/status/')[1]?.split('?')[0];
                list.innerHTML += `
                    <div class="bg-white rounded-xl overflow-hidden shadow-sm border border-pink-100">
                        <iframe src="https://platform.twitter.com/embed/Tweet.html?id=${tweetId}" class="w-full h-[450px] border-none scale-90"></iframe>
                        <a href="${item.url}" target="_blank" class="block w-full py-3 bg-[#1da1f2] text-white text-center font-bold text-sm">Xã§ç›´æ¥å¿œæ´ï¼</a>
                    </div>`;
            });
        }

        // ãŠã¯Vã‚¹ã‚¿ãƒƒã‚¯ï¼ˆçˆ†é€Ÿé‘‘å®šï¼‰
        function renderStack() {
            const stack = document.getElementById('ohvStack');
            stack.innerHTML = "";
            const ohvs = allData.filter(d => d.type === "ãŠã¯V").reverse();
            ohvs.forEach((item, idx) => {
                const tweetId = item.url.split('/status/')[1]?.split('?')[0];
                const card = document.createElement('div');
                card.className = "swipe-card";
                card.style.zIndex = 100 - idx;
                card.innerHTML = `
                    <div class="iframe-container">
                        <iframe src="https://platform.twitter.com/embed/Tweet.html?id=${tweetId}"></iframe>
                    </div>
                    <div class="card-cover" onclick="window.open('${item.url}', '_blank')"></div>
                `;
                stack.appendChild(card);
            });
            updateTrayVisibility();
        }

        // Vå›³é‘‘
        function renderZukan() {
            const list = document.getElementById('zukanList');
            list.innerHTML = "";
            // ã‚¹ã‚³ã‚¢ãŒé«˜ã„é †ãªã©ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä»Šå¾Œè¿½åŠ 
            allData.filter(d => d.type === "ãŠã¯V").forEach(item => {
                const tweetId = item.url.split('/status/')[1]?.split('?')[0];
                list.innerHTML += `
                    <div class="zukan-card">
                        <img src="https://social-plugins.line.me/img/button/default/80x20.png" class="hidden"> <div class="p-2 space-y-2">
                            <div class="flex flex-wrap gap-1">
                                <span class="score-tag">#${item.voice || 'æœªé‘‘å®š'}</span>
                                <span class="score-tag">#${item.atm || 'é‘‘å®šä¸­'}</span>
                            </div>
                            <button onclick="window.open('${item.url}', '_blank')" class="text-[9px] text-blue-400 underline">ãƒã‚¹ãƒˆã‚’è¦‹ã‚‹</button>
                        </div>
                    </div>`;
            });
        }

        // é‘‘å®šã‚¢ã‚¯ã‚·ãƒ§ãƒ³
        function chooseStep1(voice) {
            selectedVoice = voice;
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.remove('hidden');
        }

        function cancelAuth() {
            document.getElementById('step1').classList.remove('hidden');
            document.getElementById('step2').classList.add('hidden');
            nextCard(true); // ã‚¹ãƒ«ãƒ¼
        }

        async function completeAuth(atm) {
            const ohvs = allData.filter(d => d.type === "ãŠã¯V").reverse();
            const target = ohvs[currentCardIndex];
            
            // GASã¸æŠ•ç¥¨é€ä¿¡ï¼ˆå®Ÿéš›ã¯ã“ã“ã§POSTï¼‰
            console.log("é‘‘å®šå®Œäº†:", target.url, selectedVoice, atm);
            
            // æ¼”å‡ºã¨æ¬¡ã¸
            nextCard(false);
            
            // ãƒˆãƒ¬ã‚¤ã‚’ãƒªã‚»ãƒƒãƒˆ
            setTimeout(() => {
                document.getElementById('step1').classList.remove('hidden');
                document.getElementById('step2').classList.add('hidden');
            }, 500);
        }

        function nextCard(isSkip) {
            const cards = document.querySelectorAll('.swipe-card');
            if(cards[currentCardIndex]) {
                cards[currentCardIndex].classList.add(isSkip ? 'swiped-left' : 'swiped-right');
                currentCardIndex++;
                updateTrayVisibility();
            }
        }

        function updateTrayVisibility() {
            const tray = document.getElementById('tagTray');
            const stack = document.getElementById('ohvStack');
            if (document.getElementById('viewOhv').classList.contains('hidden') || currentCardIndex >= stack.children.length) {
                tray.classList.remove('open');
            } else {
                tray.classList.add('open');
            }
        }

        function switchTab(tab) {
            document.getElementById('viewMain').classList.toggle('hidden', tab !== 'main');
            document.getElementById('viewOhv').classList.toggle('hidden', tab !== 'ohv');
            document.getElementById('viewZukan').classList.toggle('hidden', tab !== 'zukan');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');
            updateTrayVisibility();
        }

        window.onload = fetchData;
    </script>
</body>
</html>